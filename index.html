<!doctype html>
<html lang="en">
	<meta charset="utf-8">
	<title>Trivia</title>
	<head>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
		<script src="/assets/js/underscore-min.js"></script>
		<script src="/assets/js/backbone-min.js"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script src="/assets/js/mustache.js"></script>
		<script src="/assets/js/jquery.cookie.js"></script>
		<script type="text/javascript"> 
			$(document).ready(function() {
				var socket = io.connect('http://localhost:8080');
				socket.on('request',function() {
					var id = Math.random().toString(36).substr(2,16);
					socket.emit('registerClient',{'id' : id});
					$.cookie('registerClient', id, { expires: 7, path: '/' });
				});

				var ApplicationRouter = Backbone.Router.extend({

				  //map url routes to contained methods
				  routes: {
					  "": "home",
					  "home/": "home",
					  "create-game/": "createTrivia",
						"post/:id/": "post",
					  "contact": "contact"
				  },

				  home: function() {
					  //this.showPage('div#home-page');
				  },

				  post: function(postId) {
						console.log(parseInt(postId));
					  //this.showPage('div#about-page');
				  },

				  createTrivia: function() {
						$.get('/assets/templates/trivia.html',function(resp) {
							if(!$('#contentTrivia').length) {
								var content = Mustache.render(resp,{'action' : 'add'});
								$('.contentBlock').hide();
								$('#contentView').append(content);
							}	
							else {
								$('.contentBlock').hide();
								$('#contentTrivia').show();
							}
							bindTriviaGame();
						});
				  },

				  updateTrivia: function(triviaId) {
						console.log('game');
				  },

				  contact: function() {
					  //this.showPage('div#contact-page');
				  }

				});		

				
				var ApplicationView = Backbone.View.extend({

				  //bind view to body element (all views should be bound to DOM elements)

				  //observe navigation click events and map to contained methods
				  events: {

				  },

				  //called on instantiation
				  initialize: function(){
					  //set dependency on ApplicationRouter
					  this.router = new ApplicationRouter();
					  //call to begin monitoring uri and route changes
					  Backbone.history.start({pushState: true});
				  },

				  displayHome: function(){
					  //update url and pass true to execute route method
					  this.router.navigate("home", true);
				  },

				  displayAbout: function(){
					  //update url and pass true to execute route method
					  this.router.navigate("about", true);
				  },

				  displayContact: function(){
					  //update url and pass true to execute route method
					  this.router.navigate("contact", true);
				  },
				  
				  displayPost: function(){
					  //update url and pass true to execute route method
					  this.router.navigate("post/123456/", true);
				  }				  

				});

				var view = new ApplicationView();
				
				$('#kelton').bind('click', function(e) {
					e.preventDefault();
					view.displayPost();
					var name = $(this).attr('data-name');
					socket.emit('kelton', {'name' : name});
				});

				
				var bindTriviaGame = function() {
				
					$('#trivia-game').bind('submit', function(e) {
						e.preventDefault();
						var inputs = $('#trivia-game input');
						var form = $.map(inputs, function(n, i)
						{
								var o = {};
								o[n.name] = $(n).val();
								return o;
						});
						socket.emit('createTrivia', form[0]);
						var form = {};
						form.triviaName = $('input[name="triviaName"]',this).val();	
						console.log('hello');
						socket.emit('createTrivia', form);
					});
				};	

			});
		</script>
	</head>
	<body>
		<div id="contentView">
			<div id="main" class="contentBlock">
				<p id="status">&nbsp;</p>
				<form method="post" action="#" id="form">
				<p id="question"></p>
				<p id="answer-p">Answer: <input type="text" name="answer" id="answer"/>
				<p><button>Submit</button>
				</form>
				<a href="#" id="kelton" data-name="kperson">Click Me</a>
			</div>	
		</div>	
	</body>
</html>
